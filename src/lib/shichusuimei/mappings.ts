// 天干 (1-10)
const HEAVENLY_STEMS = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
// 地支 (1-12)
const EARTHLY_BRANCHES = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];

// 通変星マトリクス (簡略化のため計算ロジックを使用推奨だが、ここではマッピングを維持)
// ... (previous matrix code if needed, or simplified logic)

// Helper to get index
const getStemIndex = (stem: string) => HEAVENLY_STEMS.indexOf(stem);
const getBranchIndex = (branch: string) => EARTHLY_BRANCHES.indexOf(branch);

export function getTenGen(dayMaster: string, targetStem: string): string {
    const dmIdx = getStemIndex(dayMaster);
    const tgIdx = getStemIndex(targetStem);

    if (dmIdx === -1 || tgIdx === -1) return "不明";

    const matrix = [
        ["比肩", "劫財", "食神", "傷官", "偏財", "正財", "偏官", "正官", "偏印", "印綬"], // 甲
        ["劫財", "比肩", "傷官", "食神", "正財", "偏財", "正官", "偏官", "印綬", "偏印"], // 乙
        ["偏印", "印綬", "比肩", "劫財", "食神", "傷官", "偏財", "正財", "偏官", "正官"], // 丙
        ["印綬", "偏印", "劫財", "比肩", "傷官", "食神", "正財", "偏財", "正官", "偏官"], // 丁
        ["偏官", "正官", "偏印", "印綬", "比肩", "劫財", "食神", "傷官", "偏財", "正財"], // 戊
        ["正官", "偏官", "印綬", "偏印", "劫財", "比肩", "傷官", "食神", "正財", "偏財"], // 己
        ["偏財", "正財", "偏官", "正官", "偏印", "印綬", "比肩", "劫財", "食神", "傷官"], // 庚
        ["正財", "偏財", "正官", "偏官", "印綬", "偏印", "劫財", "比肩", "傷官", "食神"], // 辛
        ["食神", "傷官", "偏財", "正財", "偏官", "正官", "偏印", "印綬", "比肩", "劫財"], // 壬
        ["傷官", "食神", "正財", "偏財", "正官", "偏官", "印綬", "偏印", "劫財", "比肩"], // 癸
    ];

    return matrix[dmIdx][tgIdx];
}

// 十二運表 (行: 日干, 列: 地支)
const JUNNIUN_TABLE = [
    // 子  丑  寅  卯  辰  巳  午  未  申  酉  戌  亥
    ["沐浴", "冠帯", "建禄", "帝旺", "衰", "病", "死", "墓", "絶", "胎", "養", "長生"], // 甲
    ["病", "衰", "帝旺", "建禄", "冠帯", "沐浴", "長生", "養", "胎", "絶", "墓", "死"], // 乙
    ["胎", "養", "長生", "沐浴", "冠帯", "建禄", "帝旺", "衰", "病", "死", "墓", "絶"], // 丙
    ["絶", "墓", "死", "病", "衰", "帝旺", "建禄", "冠帯", "沐浴", "長生", "養", "胎"], // 丁
    ["胎", "養", "長生", "沐浴", "冠帯", "建禄", "帝旺", "衰", "病", "死", "墓", "絶"], // 戊
    ["絶", "墓", "死", "病", "衰", "帝旺", "建禄", "冠帯", "沐浴", "長生", "養", "胎"], // 己
    ["死", "墓", "絶", "胎", "養", "長生", "沐浴", "冠帯", "建禄", "帝旺", "衰", "病"], // 庚
    ["長生", "養", "胎", "絶", "墓", "死", "病", "衰", "帝旺", "建禄", "冠帯", "沐浴"], // 辛
    ["帝旺", "衰", "病", "死", "墓", "絶", "胎", "養", "長生", "沐浴", "冠帯", "建禄"], // 壬
    ["建禄", "冠帯", "沐浴", "長生", "養", "胎", "絶", "墓", "死", "病", "衰", "帝旺"]  // 癸
];

export function getJunniUn(dayMaster: string, branch: string): string {
    const dmIdx = getStemIndex(dayMaster);
    const brIdx = getBranchIndex(branch);

    if (dmIdx === -1 || brIdx === -1) return "不明";

    return JUNNIUN_TABLE[dmIdx][brIdx];
}

// 蔵干テーブル (簡易版: 本気・中気・余気のうち主要なもの)
const ZOGAN_MAP: Record<string, string[]> = {
    '子': ['癸'],
    '丑': ['己', '癸', '辛'],
    '寅': ['甲', '丙', '戊'],
    '卯': ['乙'],
    '辰': ['戊', '乙', '癸'],
    '巳': ['丙', '戊', '庚'],
    '午': ['丁', '己'],
    '未': ['己', '丁', '乙'],
    '申': ['庚', '壬', '戊'],
    '酉': ['辛'],
    '戌': ['戊', '辛', '丁'],
    '亥': ['壬', '甲']
};

export function getZogan(branch: string): string[] {
    return ZOGAN_MAP[branch] || [];
}
